import { useDerivedValue, interpolate } from 'react-native-reanimated'
import type { SharedValue } from 'react-native-reanimated'

import type { OptionStackPointerProps } from '../../option-stack-pointer'
import { useInterpolateOptionStackTransitionValue } from '../../../../hooks'

type PointerProperties = {
  readonly prevInStack: () => void
  readonly nextInStack: () => void
  readonly prevPointerEvents: 'none' | 'auto'
  readonly nextPointerEvents: 'none' | 'auto'
  readonly prevPointerOpacity: SharedValue<number>
  readonly nextPointerOpacity: SharedValue<number>
}

export const useOptionStackPointerProperties = (
  props: OptionStackPointerProps
): PointerProperties => {
  const { stackLength, stateValue, transitionValue } = props
  const prevInStack = (): void => {
    stateValue.value = stateValue.value - 1
  }
  const nextInStack = (): void => {
    stateValue.value = stateValue.value + 1
  }
  const prevPointerEvents = (stateValue.value === 0 ? 'none' : 'auto')
  const nextPointerEvents = (stateValue.value === stackLength -1 ? 'none' : 'auto')
  const prevPointerOpacity = useDerivedValue(() => interpolate(useInterpolateOptionStackTransitionValue(stackLength, 0, transitionValue.value), [0, 1], [1, 0]))
  const nextPointerOpacity = useDerivedValue(() => interpolate(useInterpolateOptionStackTransitionValue(stackLength, stackLength - 1, transitionValue.value), [0, 1], [1, 0]))

  return {
    prevInStack,
    nextInStack,
    prevPointerEvents,
    nextPointerEvents,
    prevPointerOpacity,
    nextPointerOpacity,
  }
}
